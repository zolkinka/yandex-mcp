# Управление очередью задач в Yandex Tracker

Добавлена поддержка изменения очереди задач через MCP сервер.

## Способы изменения очереди

### 1. Через updateIssue (простое изменение)

**Инструмент:** `updateIssueTool`

**Описание:** Редактирует параметры задачи, включая очередь. Подходит для простого переноса задачи без дополнительных настроек.

**Новый параметр:**
- `queue` (string, optional) - Новая очередь (ключ очереди, например: TEST, NEW, PROD)

**Пример использования:**
```typescript
{
  "issueKey": "TEST-123",
  "queue": "NEW",
  "summary": "Новое название задачи"
}
```

**API:** `PATCH /v3/issues/<issue_key>`

**Особенности:**
- Простой перенос в другую очередь
- Можно одновременно изменять другие параметры (название, описание, приоритет и т.д.)
- При переносе могут быть очищены компоненты, версии и проекты

---

### 2. Через moveIssue (расширенный перенос)

**Инструмент:** `moveIssueTool` (новый)

**Описание:** Специализированный метод для переноса задачи в другую очередь с дополнительными опциями.

**Параметры:**
- `issueKey` (string) - Ключ задачи для переноса (например: TEST-123)
- `queue` (string) - Ключ целевой очереди (например: NEW)
- `moveAllFields` (boolean, optional) - Перенести компоненты, версии и проекты, если есть аналогичные в новой очереди
- `initialStatus` (boolean, optional) - Сбросить статус задачи в начальное значение новой очереди

**Пример использования:**

**Простой перенос:**
```typescript
{
  "issueKey": "TEST-123",
  "queue": "NEW"
}
```

**Перенос с сохранением полей:**
```typescript
{
  "issueKey": "TEST-123",
  "queue": "NEW",
  "moveAllFields": true
}
```

**Перенос со сбросом статуса:**
```typescript
{
  "issueKey": "TEST-123",
  "queue": "NEW",
  "initialStatus": true
}
```

**API:** `POST /v3/issues/<issue_key>/_move?queue=<queue_key>`

**Особенности:**
- Специализирован для переноса между очередями
- Поддержка сохранения компонентов, версий и проектов
- Возможность сброса статуса в начальное значение
- Возвращает обновленную задачу с новым ключом (например: NEW-1)
- В ответе содержится поле `aliases` со старым ключом задачи

---

## Когда использовать каждый метод

### Используйте updateIssue:
- ✅ Простой перенос задачи в другую очередь
- ✅ Одновременно нужно изменить и другие параметры (название, описание, приоритет)
- ✅ Не важны компоненты, версии и проекты

### Используйте moveIssue:
- ✅ Перенос задачи с сохранением компонентов, версий, проектов
- ✅ Нужно сбросить статус задачи в начальное значение новой очереди
- ✅ Важна специфика переноса между очередями
- ✅ Нужна информация о старом ключе задачи (aliases)

---

## Важные замечания

### Перед переносом убедитесь:
1. ✅ Пользователь имеет доступ к редактированию задачи
2. ✅ Пользователь имеет права на создание задач в новой очереди
3. ✅ Тип и статус задачи существуют в новой очереди (или используйте `initialStatus: true`)

### Что происходит при переносе:
- **По умолчанию очищаются:** компоненты, версии, проекты
- **Сохранить можно:** используя параметр `moveAllFields: true` (только если аналогичные значения есть в новой очереди)
- **Локальные поля:** удаляются при переносе в другую очередь
- **Статус:** можно сбросить в начальное значение с помощью `initialStatus: true`

### Ключ задачи меняется:
После переноса задача получит новый ключ с префиксом новой очереди:
- Было: `TEST-123`
- Стало: `NEW-1`
- Старый ключ сохраняется в `aliases`

---

## Примеры сценариев

### Сценарий 1: Простой перенос из TEST в PROD
```typescript
{
  "issueKey": "TEST-123",
  "queue": "PROD"
}
```

### Сценарий 2: Перенос с изменением названия и приоритета
```typescript
{
  "issueKey": "TEST-123",
  "queue": "PROD",
  "summary": "Production Issue",
  "priority": "critical"
}
```
_(используйте updateIssueTool)_

### Сценарий 3: Перенос из DEV в TEST с сохранением полей
```typescript
{
  "issueKey": "DEV-456",
  "queue": "TEST",
  "moveAllFields": true
}
```
_(используйте moveIssueTool)_

### Сценарий 4: Перенос в новую очередь со сбросом статуса
```typescript
{
  "issueKey": "OLD-789",
  "queue": "NEW",
  "initialStatus": true,
  "moveAllFields": true
}
```
_(используйте moveIssueTool)_

---

## Структура ответа при переносе

```json
{
  "self": "https://api.tracker.yandex.net/v3/issues/NEW-1",
  "id": "1a********",
  "key": "NEW-1",
  "version": 2,
  "aliases": ["TEST-123"],
  "previousQueue": {
    "self": "https://api.tracker.yandex.net/v3/queues/TEST",
    "id": "3",
    "key": "TEST",
    "display": "TEST"
  },
  "queue": {
    "self": "https://api.tracker.yandex.net/v3/queues/NEW",
    "id": "5",
    "key": "NEW",
    "display": "New Queue"
  },
  ...
}
```

---

## Обработка ошибок

### Типичные ошибки:
1. **Недостаточно прав** - проверьте права доступа к обеим очередям
2. **Несовместимый тип/статус** - используйте `initialStatus: true` или измените тип задачи
3. **Очередь не найдена** - убедитесь, что ключ очереди указан верно

---

## См. также

- [Yandex Tracker API - Редактировать задачу](https://yandex.cloud/docs/tracker/concepts/issues/patch-issue)
- [Yandex Tracker API - Перенести задачу в другую очередь](https://yandex.ru/support/tracker/ru/concepts/issues/move-issue)
- [ATTACHMENTS.md](ATTACHMENTS.md) - Работа с вложениями
